<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="edu.example.bughunters.dao.PetDAO">
	<insert id="signUpPet">
        INSERT INTO Pet 
        (name, kind, age, gender, profile_image, color, weight, intro, user_id)
        VALUES (
            #{pet.name},
            #{pet.kind},
            #{pet.age},
            #{pet.gender},
            #{image, jdbcType=BLOB},
            #{pet.color},
            #{pet.weight},
            #{pet.intro},
            #{pet.userId}
        )
	</insert>
	
	<select id="getMyPet">
		SELECT *
		FROM Pet
		WHERE user_id = #{userId}
	</select>
	
	<insert id="registerWalking">
		INSERT INTO Walking
		(location, pet_id)
		VALUES (
			#{location},
			#{petId}
		)
	</insert>
	
	<select id="getWalkingList">
		SELECT *
		FROM Walking
		INNER JOIN Pet
		USING (pet_id)
	</select>
	
	<select id="isRegisterWalking">
		SELECT COUNT(*)
		FROM Walking
		WHERE pet_id = #{petId}
	</select>
	
	<update id="changeIsPet">
		UPDATE "User"
		SET is_pet = 1
		WHERE user_id = #{userId}
	</update>
	
	<select id="isUserPet">
		SELECT is_pet
		FROM "User"
		WHERE user_id = #{userId}
	</select>
	
	<update id="updatingPet">
		UPDATE Pet
		SET
		    name = #{pet.name},
		    kind = #{pet.kind},
		    age = #{pet.age},
		    gender = #{pet.gender},
		    profile_image = #{image, jdbcType=BLOB},
		    color = #{pet.color},
		    weight = #{pet.weight},
		    intro = #{pet.intro}
		WHERE
		    pet_id = #{pet.petId}
	</update>
	
	<select id="selectPetById">
	    SELECT
	        profile_image
	    FROM Pet
	    WHERE pet_id = #{petId}
	</select>
	
	<delete id="removeMyPet">
		DELETE FROM Pet
		WHERE user_id = #{userId}
	</delete>
	
	<update id="updateUserPet">
		UPDATE "User"
		SET is_pet = 0
		WHERE user_id = #{userId}
	</update>
</mapper>