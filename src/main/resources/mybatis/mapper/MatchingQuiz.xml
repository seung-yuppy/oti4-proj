<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="edu.example.bughunters.dao.MatchingQuizDAO">

	<!-- 카테고리 1개에 대해 랜덤 1문항 -->
	<select id="selectRandomQuiz" parameterType="java.lang.String"
		resultType="edu.example.bughunters.domain.MatchingQuizDTO">
		SELECT
		q.matching_quiz_id AS matchingQuizId,
		q.quiz_question AS quizQuestion,
		q.quiz_category AS quizCategory
		FROM (
		SELECT *
		FROM Matching_Quiz
		WHERE quiz_category = #{quizCategory}
		ORDER BY DBMS_RANDOM.VALUE
		) q
		WHERE ROWNUM = 1
	</select>

	<!-- 선택된 quizIds에 대한 답변 전체 조회 -->
	<select id="selectAnswersByQuizIds" parameterType="list"
		resultType="edu.example.bughunters.domain.MatchingAnswerDTO">
		SELECT
		a.matching_answer_id AS matchingAnswerId,
		a.quiz_answer AS quizAnswer,
		a.matching_quiz_id AS matchingQuizId,
		TO_CHAR(a.answer_weight) AS answerWeight
		FROM Matching_Answer a
		WHERE a.matching_quiz_id IN
		<foreach collection="quizIds" item="id" open="(" separator=","
			close=")">
			#{id}
		</foreach>
		ORDER BY a.matching_quiz_id, a.matching_answer_id
	</select>

</mapper>



