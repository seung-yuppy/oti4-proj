<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="edu.example.bughunters.dao.MatchingQuizDAO">

	<!-- 카테고리 1개에 대해 랜덤 1문항 -->
	<select id="selectRandomQuiz" parameterType="java.lang.String"
		resultType="edu.example.bughunters.domain.MatchingQuizDTO">
		SELECT
		q.matching_quiz_id,
		q.quiz_question,
		q.quiz_category
		FROM (
		SELECT *
		FROM Matching_Quiz
		WHERE quiz_category = #{quizCategory}
		ORDER BY DBMS_RANDOM.VALUE
		) q
		WHERE ROWNUM = 1
	</select>

	<!-- 선택된 quizIds에 대한 답변 전체 조회 -->
	<select id="selectAnswersByQuizIds" parameterType="list"
		resultType="edu.example.bughunters.domain.MatchingAnswerDTO">
		SELECT
		matching_answer_id,
		quiz_answer,
		matching_quiz_id,
		TO_CHAR(answer_weight)
		FROM Matching_Answer 
		WHERE matching_quiz_id IN
		<foreach collection="quizIds" item="id" open="(" separator=","
			close=")">
			#{id}
		</foreach>
		ORDER BY matching_quiz_id, matching_answer_id
	</select>

</mapper>



