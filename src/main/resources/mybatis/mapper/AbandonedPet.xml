<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="edu.example.bughunters.dao.AbandonedPetDAO">
	<select id="countAll" resultType="int">
		SELECT COUNT(*)
		FROM Abandoned_Pet
	</select>
	<select id="listAll" resultType="AbandonedPetDTO" parameterType="int">
		SELECT *
		FROM (
			SELECT ROWNUM AS rnum, a.*
			FROM (
				SELECT *
				FROM Abandoned_Pet
				ORDER BY abandoned_pet_id
				) a
			)
		WHERE rnum BETWEEN #{start} AND #{end}
	</select>
	<select id="listOne" resultType="AbandonedPetDTO" parameterType="int">
		SELECT *
		FROM Abandoned_Pet
		WHERE abandoned_pet_id = #{id}
	</select>
	<select id="countSearch" resultType="int">
		SELECT COUNT(*)
		FROM Abandoned_Pet
		<where>
			<if test="location != 'all'">
				AND address LIKE
				<choose>
					<when test="location == 'seoul'">
						'서울%'
					</when>
					<when test="location == 'gyeonggi'">
						'경기%'
					</when>
					<when test="location == 'incheon'">
						'인천%'
					</when>
					<when test="location == 'ulsan'">
						'울산%'
					</when>
					<when test="location == 'busan'">
						'부산%'
					</when>
					<when test="location == 'sejong'">
						'세종%'
					</when>
					<when test="location == 'daejeon'">
						'대전%'
					</when>
					<when test="location == 'daegu'">
						'대구%'
					</when>
					<when test="location == 'gwangju'">
						'광주%'
					</when>
					<when test="location == 'jeju'">
						'제주%'
					</when>
					<when test="location == 'gangwon'">
						'강원%'
					</when>
					<when test="location == 'gyeongnam'">
						'경상남도%'
					</when>
					<when test="location == 'gyeongbuk'">
						'경상북도%'
					</when>
					<when test="location == 'chungnam'">
						'충청남도%'
					</when>
					<when test="location == 'chungbuk'">
						'충청북도%'
					</when>
					<when test="location == 'jeonnam'">
						'전라남도%'
					</when>
					<when test="location == 'jeonbuk'">
						'전북%'
					</when>
				</choose>
			</if>
			<if test="gender != 'all'">
				AND gender = #{gender}
			</if>
			<if test="size != 'all'">
				<choose>
					<when test="size == 'small'">
						AND weight BETWEEN 0 AND 9
					</when>
					<when test="size == 'medium'">
						AND weight BETWEEN 10 AND 24
					</when>
					<when test="size == 'large'">
						AND weight >= 25
					</when>
				</choose>
			</if>
			<if test="age != 'all'">
				<choose>
					<when test="age == '0-1'">
						AND age BETWEEN 2024 AND 2025
					</when>
					<when test="age == '2-4'">
						AND age BETWEEN 2021 AND 2023
					</when>
					<when test="age == '5-7'">
						AND age BETWEEN 2018 AND 2020
					</when>
					<when test="age == '8+'">
						AND 2017 >= age
					</when>
				</choose>
			</if>
		</where>
	</select>
	<select id="listSearch" resultType="AbandonedPetDTO">
        SELECT *
        FROM (
            SELECT ROWNUM AS rnum, a.*
            FROM (
                SELECT *
                FROM Abandoned_Pet
                <where>
                    <if test="location != 'all'">
                        AND address LIKE
                        <choose>
                            <when test="location == 'seoul'">
                                '서울%'
                            </when>
                            <when test="location == 'gyeonggi'">
                                '경기%'
                            </when>
                            <when test="location == 'incheon'">
                                '인천%'
                            </when>
                            <when test="location == 'ulsan'">
                                '울산%'
                            </when>
                            <when test="location == 'busan'">
                                '부산%'
                            </when>
                            <when test="location == 'sejong'">
                                '세종%'
                            </when>
                            <when test="location == 'daejeon'">
                                '대전%'
                            </when>
                            <when test="location == 'daegu'">
                                '대구%'
                            </when>
                            <when test="location == 'gwangju'">
                                '광주%'
                            </when>
                            <when test="location == 'jeju'">
                                '제주%'
                            </when>
                            <when test="location == 'gangwon'">
                                '강원%'
                            </when>
                            <when test="location == 'gyeongnam'">
                                '경상남도%'
                            </when>
                            <when test="location == 'gyeongbuk'">
                                '경상북도%'
                            </when>
                            <when test="location == 'chungnam'">
                                '충청남도%'
                            </when>
                            <when test="location == 'chungbuk'">
                                '충청북도%'
                            </when>
                            <when test="location == 'jeonnam'">
                                '전라남도%'
                            </when>
                            <when test="location == 'jeonbuk'">
                                '전북%'
                            </when>
                        </choose>
                    </if>
                    <if test="gender != 'all'">
                        AND gender = #{gender}
                    </if>
                    <if test="size != 'all'">
                        <choose>
                            <when test="size == 'small'">
                                AND weight BETWEEN 0 AND 9
                            </when>
                            <when test="size == 'medium'">
                                AND weight BETWEEN 10 AND 24
                            </when>
                            <when test="size == 'large'">
                                AND weight >= 25
                            </when>
                        </choose>
                    </if>
                    <if test="age != 'all'">
						<choose>
							<when test="age == '0-1'">
								AND age BETWEEN 2024 AND 2025
							</when>
							<when test="age == '2-4'">
								AND age BETWEEN 2021 AND 2023
							</when>
							<when test="age == '5-7'">
								AND age BETWEEN 2018 AND 2020
							</when>
							<when test="age == '8+'">
								AND 2017 >= age
							</when>
						</choose>
                    </if>
                </where>
                ORDER BY abandoned_pet_id DESC
            ) a
            WHERE ROWNUM &lt;= #{end}
        )
        WHERE rnum BETWEEN #{start} AND #{end}
	</select>
	<insert id="likePet">
		INSERT INTO Like_Abandoned_Pet
		(user_id, abandoned_pet_id)
		VALUES (#{userId}, #{abandonedPetId})
	</insert>
	<delete id="likeCancel">
		DELETE FROM Like_Abandoned_Pet
		WHERE user_id = #{userId}
		AND abandoned_pet_id = #{abandonedPetId}
	</delete>
	<select id="isLikePet">
		SELECT count(*)
		FROM Like_Abandoned_Pet
		WHERE user_id = #{userId}
		AND abandoned_pet_id = #{abandonedPetId}
	</select>
	<select id="likeList">
		SELECT *
		FROM Like_Abandoned_Pet
		INNER JOIN Abandoned_Pet 
		USING (abandoned_pet_id)
		WHERE user_id = #{userId}
	</select>
</mapper>